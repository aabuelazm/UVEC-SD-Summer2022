#pragma config(Sensor,	dgtl1,	button,	sensorTouch)
#pragma config(Sensor,	in1,	sClaw,	sensorPotentiometer)
#pragma config(Sensor,	dgtl9,	sFront,	sensorSONAR_mm)
#pragma config(Sensor,	dgtl11,	sBack,	sensorSONAR_mm)
#pragma config(Motor,	port1,	mDrive,	tmotorVex393_HBridge,	openLoop)
#pragma config(Motor,	port2,	mArm,	tmotorVex393_MC29,		openLoop)
#pragma config(Motor,	port3,	mClaw,	tmotorVex393_MC29,		openLoop)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#define WHEEL_SPEED 100
#define ARM_SPEED 100
#define ARM_DISTANCE 420
#define ARM_DROP 42
#define CLAW_SPEED 100
#define CLAW_DISTANCE 20
#define CLOSE_CLAW 69

enum SystemPhase {
	idle,
	moveFore,
	pickup,
	moveBack,
	egg
};
SystemPhase phase = idle;

task main() {
	while(true){
		switch (phase) {
			case idle:
				if (SensorValue[button]) {
					motor[mDrive] = WHEEL_SPEED;
					++phase;
				}
				break;

			case moveFore:
				if (SensorValue[sFront] <= CLAW_DISTANCE) {
					motor[mDrive] = 0;
					++phase;
				}
				break;

			case pickup:
				motor[mClaw] = CLAW_SPEED;
				while (SensorValue[sClaw] >= CLOSE_CLAW) {}
				motor[mClaw] = 0;
				motor[mDrive] = -WHEEL_SPEED;
				++phase;
				break;

			case moveBack:
				if (SensorValue[sBack] <= ARM_DISTANCE) {
					motor[mDrive] = 0;
					++phase;
				}
				break;

			case gg:
				motor[mArm] = ARM_SPEED;
				while (SensorValue[sArm] <= ARM_DROP) {}
				motor[mArm] = 0;
				phase = idle;
				break;
		}
	}
}
